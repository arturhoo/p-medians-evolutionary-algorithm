\documentclass[12pt]{article}
\usepackage{sbc-template}
\usepackage{graphicx}
\usepackage{graphics}
\usepackage{amsmath}
\usepackage{booktabs}
\usepackage{rotating}
\usepackage{subfigure}
\usepackage{times,amsmath,epsfig}
\usepackage{url}
\usepackage{multirow}
 \makeatletter
 \newif\if@restonecol
 \makeatother
 \let\algorithm\relax
 \let\endalgorithm\relax
\usepackage{listings}
\usepackage{float}
\usepackage[lined,algonl,ruled]{algorithm2e}
\usepackage{multirow}
\usepackage[brazil]{babel}
\usepackage[latin1]{inputenc}
\usepackage{enumitem}

\lstset{ %
language=Gnuplot,                  % choose the language of the code
basicstyle=\footnotesize,       % the size of the fonts that are used for the code
numbers=left,                   % where to put the line-numbers
numberstyle=\footnotesize,      % the size of the fonts that are used for the line-numbers
stepnumber=2,                   % the step between two line-numbers. If it's 1 each line will be numbered
numbersep=5pt,                  % how far the line-numbers are from the code
backgroundcolor=\color{white},  % choose the background color. You must add \usepackage{color}
showspaces=false,               % show spaces adding particular underscores
showstringspaces=false,         % underline spaces within strings
showtabs=false,                 % show tabs within strings adding particular underscores
frame=single,	                % adds a frame around the code
tabsize=2,	                    % sets default tabsize to 2 spaces
captionpos=b,                   % sets the caption-position to bottom
breaklines=true,                % sets automatic line breaking
breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
title=\lstname,                 % show the filename of files included with \lstinputlisting; also try caption instead of title
}

\setlist{nolistsep}

\sloppy

\title{TRABALHO PRÁTICO 1: \\Um Algoritmo Genético para resolver o problema da $p$-Mediana com restrições de capacidade}

\author{Artur Rodrigues}

\address{Departamento de Ciência da Computação \\ Universidade Federal de Minas Gerais (UFMG)
\email{artur@dcc.ufmg.br}
}

\begin{document}

\maketitle

\section{INTRODUÇÃO}

Problemas de localização de facilidades tem diversas aplicações em telecomunicações, transportes, orquestração de tarefas e distribuição. Uma importante maneira de medir a eficácia de uma localidade de uma facilidade é avaliando o decaimento da média (total) das distancias em função do aumento da acessibilidade e eficiência da facilidade. O problema da $p$-Mediana é um dos problemas mais conhecidos no âmbito de localização de facilidades e aplica essa avaliação ao tentar minimizar a distancia (total) entre as demandas e um numero $p$ de localidades selecionados, chamadas de medianas. O custo total da solução é a soma das distancias entre os pontos de demanda e as medianas.

No problema da $p$-Mediana não capacitado, é considerado que cada facilidade candidata a se tornar mediana pode satisfazer um número ilimitado de pontos de demanda. Em contraste, no problema da $p$-Mediana capacitado, cada facilidade candidata a mediana tem uma capacidade fixa, i.e. um número máximo de unidades de demanda que ela pode satisfazer. Esse problema é NP-Difícil e, portanto, mesmo heurísticas especializadas em resolver esse problema demandam um esforço computacional considerável.

Nesse trabalho o problema da $p$-Mediana capacitado é resolvido através de algoritmos genéticos. Adicionalmente, é empregada uma técnica para o assinalamento de pontos de demanda às $p$ medianas candidatas. Para avaliar a qualidade dessa heurística, o método é avaliado em comparação a solução ótima para algumas instancias selecionadas. Finalmente, é feita uma avaliação do impacto de diversos parâmetros nos resultados obtidos.


% \section{O PROBLEMA DA $p$-MEDIANA CAPACITADO}


\section{MODELAGEM DO ALGORITMO GENÉTICO}

O algoritmo genético (GA) é uma classe de heurísticas adaptativas baseado no conceito de avaliação do ``melhor adaptado''. O algoritmo genético desenvolvido nesse trabalho é detalhado a seguir

\subsection{Representação do Indivíduo}

Cada individuo (cromossomo) possui exatamente $p$ genes, onde $p$ é o número de medianas, e cada alelo de cada gene representa as coordenadas de uma facilidade e, por consequência, identifica unicamente uma localidade. No GA em questão, o genoma é interpretado como um conjunto de facilidades, no sentido matemático de conjunto, onde não existem elementos duplicados e não há ordem entre esses elementos.

\subsection{Avaliação da \textit{Fitness}}

Dado que as medianas são selecionadas, cada facilidade é assinalada a uma mediana (como será apresentado adiante) e assim que todos os vértices são estabelecidos, a fitness do indivíduo pode ser computada através da soma das distancias Euclidianas entre cada vértice e sua mediana. A soma mínima é a solução.

\subsection{Assinalamento de Facilidades}

O assinalamento de facilidades a medianas candidatas, processo necessário ao cálculo da fitness é feito através da alocação das facilidades com maiores demandas primeiro à mediana mais próxima, em termos de distância Euclidiana que tenha capacidade de atender a demanda. Dessa maneira, como cada mediana tem uma capacidade fixa, algumas facilidades terão de ser assinaladas à segunda (ou terceira, quarta...) mediana mais próxima.

\subsection{Seleção}

Algoritmos genéticos consistem de três operadores primários: 1) reprodução, 2) \textit{crossover} e 3) mutação.

Reprodução é o processo no qual características das soluções são passadas de uma geração para a outra. A solução escolhida para reprodução é feita através de uma técnica aleatória e ao mesmo tempo enviesada conhecida como torneio. Nela são escolhidos $k$ elementos aleatórios da população, onde esses elementos irão competir no processo de reprodução.

\subsection{\textit{Crossover}}

O \textit{crossover} usado nesse trabalho inicialmente computa dois vetores denominados vetores de câmbio, um para cada pai, como segue. O vetor de câmbio do pai 1 representa o complemento da interseção entre os cromossomos de ambos os pais em relação ao próprio cromossomo do pai 1, o mesmo é válido para o pai 2. Os conteúdos desses vetores serão cruzados de maneira aleatória e os dois vetores resultantes serão unidos à interseção dos cromossomos dos pais, produzindo dois novos cromossomos de tamanho $p$, denominados filhos.

Se ambos os pais são identicos, somente um deles é passado para a nova geração no processo de reprodução.

\subsection{Mutação}

A mutação ocorre como se segue. O gene a ser mutado tem um de seus alelos, escolhido aleatoriamente, substituído por outro alelo aleatório (uma facilidade). Isso ocorre com a restrição de que a nova facilidade não está presente no genótipo atual do indivíduo.

\subsection{Preenchimento populacional}

O processo de preenchimento da nova população ocorre a partir do processo de seleção dos indivíduos do torneio e da geração de um número aleatório $r$ que determinará quais operações de reprodução serão aplicadas, com base nas probabilidades dessas operações (mutação e \textit{crossover}). Esse procedimento se repete até que a nova população possua o número de indivíduos desejado, como se segue:

\begin{algorithm}[H]
\begin{footnotesize}
    nova população $\leftarrow$ []\;
    \While{$|$nova população$|$ $<$ tamanho da população}{
        r $\leftarrow$ $random(0, 1)$\;
        indivíduos do torneio $\leftarrow sample$(população, tamanho do torneio)\;
        \If{r $<$ probabilidade de mutação}{
            $mutate$(melhor indivíduo do torneio)\;
            insere a mutação na nova população\;
        }\ElseIf{r $<$ probabilidade de crossover}{
            $crossover$(dois melhores indivíduos do torneio)
            insere filhos na nova população\;
        }{
            insere melhor indivíduo do torneio na nova população\;
        }
    }
\caption{Preenchimento populacional}
\end{footnotesize}
\end{algorithm}

\subsection{Elitismo}

Durante o processo evolucionário, pode ser introduzido um fator de elitismo. Caso ele esteja presente, uma fração, definida por esse fator, dos melhores indivíduos da população atual é introduzida diretamente na nova população, sem alterações em seu material genético.

\subsection{Abstrações adicionais}

Tendo sido apresentado o modelo, o algoritmo evolucionário foi implementado utilizando-se a linguagem \textit{Python}, com o auxílio da biblioteca \textit{NetworkX}\footnote{http://networkx.lanl.gov/} que provê estruturas de dados e funções para o manuseio de Grafos. A estrutura de grafo completo é utilizada para a representação das instâncias, onde as coordenadas de uma facilidades identificam-na como um nó, e a distância entre elas é representada como o peso das arestas do grafo completo.


\section{AVALIAÇÃO EXPERIMENTAL E RESULTADOS}

\subsection{Procedimentos}

Com o intuito de se obter testes mais consistentes, os experimentos foram executados em ambiente virtualizado, com capacidade de processamento e memória primário reduzidas, 30\% da capacidade da máquina hospedeira e 512MiB, respectivamente. O sistema operacional do ambiente virtualizado era Ubuntu Server 12.04 64 bits e os softwares utilizados foram interpretador Python (2.7.2) PyPy versão 1.9.0, e GCC versão 4.2.1. A máquina hospedeira possuía sistema operacional Mac OS X 10.8.2, processador \textit{quad-core} de 2.3GHz e memória primária com capacidade de 8GiB.

Para cada experimento realizado foram aferidos os valores médios para as \textit{fitness} do melhor e pior indivíduo, geração onde foi encontrada a melhor solução, \textit{fitness} média e o número de indivíduos repetidos na população final, tempo de execução e porcentagem de filhos melhores que os pais no processo de \textit{crossover}. É importante ressaltar que, devido à natureza estocástica da solução, cada problema foi executado 30 vezes e os valores médios, acompanhados do desvio padrão para cada medida foram considerados.

A primeira série de experimentos utilizou a base \textit{SJC1.dat} disponibilizada, e através dessa série foram identificados os melhores valores para os seguintes parâmetros:

\begin{itemize}
    \item $popsize$: tamanho da população;
    \item $gener$: número de gerações;
    \item $mutprob$: probabilidade de mutação;
    \item $coprob$: probabilidade de \textit{crossover};
    \item $tsize$: tamanho do torneio;
    \item $elitism$: fração de elitismo;
\end{itemize}

O processo de avaliação de parâmetros seguiu a seguinte metodologia:

\begin{enumerate}
    \item Definição de parâmetros iniciais: $popsize=100$, $gener=100$, $mutprob=0.001$, $coprob=0.6$, $tsize=2$, $elitism=0.01$ .
    \item Avaliação do incremento de $popsize$ e $gener$. Definição de valores bases para esses parâmetros.
    \item Avaliação da sensibilidade da solução, com base em variações nos valores de probabilidade $mutprob$ e $coprob$. Definição de melhores valores para esses parâmetros.
    \item Aumento do tamanho do torneio $tsize$. Avaliação do impacto na qualidade da solução.
    \item Retirada do fator de elitismo $elitism$. Avaliação do impacto na qualidade da solução.
    \item Incremento do fator de elitismo $elitism$. Avaliação do impacto na qualidade da solução.
    \item Combinação dos melhores parâmetros com vistas nas outras medidas aferidas, como geração onde a melhor solução foi encontrada e número de indivíduos repetidos.
\end{enumerate}

Tendo sido idenficados os melhores parâmetros para a instância base, estes foram aplicados às outras instâncias disponibilizadas: \textit{SJC2.dat, SJC3b.dat} e \textit{SJC4a.dat}. Os resultados podem ser encontrados na próxima seção.

\subsection{Resultados}

A sequência de avaliação dos parâmetros descrita na seção anterior feita na base \textit{SJC1.dat} pode ser vista na tabela \ref{tabela1}. A primeira alteração realizada sob os parâmetros iniciais, um aumento para 500 gerações, sinalizou para uma melhora na qualidade da solução, o erro caiu de 18.3\% para 16.0\%, todavia, a solução foi encontrada, em média, na geração 235, indicando que o alto numéro de gerações não contribuiu plenamente para a qualidade da solução. Como consequência do prematuro encontro da melhor solução, a configuração apresentou uma das menores \textit{fitness} médias. Outro detalhe interessante dessa configuração é a baixa porcentagem de filhos melhores que os pais na operação de \textit{crossover}.

Em seguida, tendo sido retornado o valor do número de gerações para o valor inicial, foi elevado o tamanho da população para 500, o que resultou numa melhora significativa, diminuindo o erro da solução encontrada para 11.8\%. Realizando novamente o aumento do número de gerações para 500, o erro reduziu ainda mais, chegando ao índice de 9.2\%, entretando, ficou evidenciado o grande número de indíviduos repetidos na solução final, e novamente o ``desperdício'' de gerações (a melhor solução foi encontrada, em média, na geração 257). Conclui-se que bons valores para os parâmetro tamanho da população e número de gerações são 200 e 250, respectivamente.

A avaliação continuou, dessa vez avaliando o aumento da probabilidade de \textit{crossover} para 0.6 para 0.8, o que não representou nenhuma melhora significativa, o que levou a manutenção do valor desse parâmetro em 0.6. Em seguida, foi alterado o valor da probabilidade de mutação, o que causa uma diminuição na pressão seletiva. A primeira alteração de 0.001 para 0.01 não trouxe melhoras visíveis a não ser o encontro da solução em uma geração mais avançada, mas alteração seguinte, para 0.1, implicou diretamente na melhora da solução, fazendo com que o erro caísse de 11.7\% para 9.8\%. Esse valor foi considerado ideal, ao ser evidenciado que um aumento para 0.3 nesse parâmetro implicou num retorno ao valor do erro anterior: 11.4\%, não obstante o número de indivíduos repetidos tenha caído de 27, em média, para 19.

Adiante, avaliou-se o impacto do tamanho do torneio. O valor inicial de 2 foi elevado para 5, o que ocasionou numa solução pior: o erro subiu de 9.8\% para 11.2\%. Assim, o valor de 2 para esse parâmetro foi mantido no restante da avaliação.

A retirada do elitismo ocasionou uma piora signficante no melhor valor da \textit{fitness}, quando o erro subiu de 9.8\% para 20.3\%. Além disso, essa melhor solução foi encontrada demasiadamente cedo, em média, na geração 68. Em contrapartida, um aumento no valor, passando de 0.01 para 0.1, resultou na melhor configuração encontrada para a avaliação experimentou: um erro médio de 5.65\%, sendo, além disso, o terceiro conjunto de parâmetros mais rápido entre os testados, definitivamente uma ótima configuração, que foi inclusive usada nas instâncias restantes. A título de experimentação, ainda foi experimentado uma última configuração que diminui a pressão seletiva ao definir a probabilidade de mutação em 0.3 e o fator de elitismo em 0.25; essa configuração se mostrou também muito boa, com um erro médio de 5.9\%, a terceira melhor \textit{fitness} média e a segunda execução mais rápida.

Dessa maneira, chegou-se a melhor configuração, que foi utilizada nas demais instâncias:

\begin{itemize}
    \item tamanho da população: 200
    \item número de gerações: 250
    \item probabilidade de mutação: 0.1
    \item probabilidade de \textit{crossover}: 0.1
    \item tamanho do torneio: 2
    \item fração de elitismo: 0.1
\end{itemize}

Finalmente, essa configuração se mostrou também boa nas demais instâncias, \textit{SJC2.dat, SJC3b.dat} e \textit{SJC4a.dat}, obtendo erros de 4.12\%, 6.04\% e 9.96\% respectivamente. Possiíveis fontes de melhorias estão no aumento do tamanho da população e do número de gerações proporcionalmente ao número de arestas dos grafos dessas instâncias. Detalhes adicionais para essas instâncias podem ser encontrados na tabela \ref{tabela2}.

% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{sidewaystable}[htbp]
  \centering
  \caption{Avaliação de parâmetros para a instância \textit{SJC1.dat}}
    \resizebox{\columnwidth}{!}{%
    \begin{tabular}{lc|c|c|c|c|c|c|c|c|c|c|c|c|c}
    \toprule[0.18em]
    \multirow{2}{*}{Operação} & \multicolumn{2}{c}{Melhor Fitness} & \multicolumn{1}{c}{Erro} & \multicolumn{2}{c}{na Geração} & \multicolumn{2}{c}{Pior Fitness} & \multicolumn{2}{c}{Fitness Média} & \multicolumn{2}{c}{Indiv. Rep.} & \multicolumn{2}{c}{Tempo de Exec.(s)} & \multicolumn{1}{c}{Filhos Melhores(\%)} \\
    \cmidrule{2-15}
    \multicolumn{1}{c}{} & \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Desvio P.} & \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Desvio P.} & \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Desvio P.} & \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Desvio P.} & \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Desvio P.} & \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Desvio P.} & \multicolumn{1}{c}{Média} \\
    \midrule
    0) população inicial & 20402.10 & 665.91 & 18.30\% & 70.0    & 22.00 & 83982.73 & 3031.61 & 34273.16 & 7344.27 & 29.2  & 6.97  & 17.05 & 0.13  & 49.34\% \\
    1) gener=500 & 20010.37 & 403.13 & 16.03\% & 234.9 & 152.99 & 85913.78 & 4588.55 & 20326.80 & 480.76 & 97.9  & 1.14  & 85.04 & 2.02  & 30.53\% \\
    2) gener=100, popsize=500 & 19284.07 & 511.12 & 11.81\% & 83.0    & 10.86 & 93121.14 & 3363.94 & 34607.48 & 2206.09 & 66.0  & 11.18 & 38.49 & 1.08  & 49.31\% \\
    3) gener=500, popsize=500 & 18842.85 & 306.43 & 9.26\% & 257.0   & 129.07 & 93292.44 & 2990.64 & 20236.16 & 912.97 & 491.0 & 6.63  & 182.30 & 4.98  & 40.28\% \\
    4) gener=250, popsize=250 & 19329.45 & 392.82 & 12.08\% & 142 & 37.14 & 88663.55 & 5077.01 & 27534.42 & 2696.14 & 149.0 & 24.15 & 37.43 & 1.15 & 49.11\% \\
    5) gener=200, popsize=250, cprob=0.8 & 19310.84 & 467.83 & 11.97\% & 134.0   & 50.77 & 89492.99 & 3135.85 & 27399.69 & 3350.50 & 147.0 & 18.33 & 43.93 & 1.08  & 48.95\% \\
    6) cprob=0.6, mutprob=0.01 & 19274.54 & 319.64 & 11.76\% & 201.0   & 31.40 & 88850.68 & 3219.30 & 28512.04 & 3587.08 & 121.0 & 16.16 & 39.27 & 1.17  & 49.27\% \\
    7) mutprob=0.1 & 18944.68 & 377.56 & 9.85\% & 204.0   & 42.56 & 92126.15 & 3257.53 & 35351.81 & 2392.47 & 27.0  & 7.21  & 39.73 & 1.79  & 49.29\% \\
    8) mutprob=0.3 & 19219.22 & 354.24 & 11.44\% & 193.0   & 46.66 & 94694.45 & 1977.13 & 38304.52 & 1926.10 & 19.0  & 3.87  & 40.02 & 1.95  & 49.51\% \\
    9) mutprob=0.1, tsize=5 & 19180.68 & 354.23 & 11.21\% & 204.0   & 26.59 & 92282.33 & 4585.54 & 34561.99 & 1397.58 & 29.0  & 5.48  & 37.78 & 2.10  & 49.29\% \\
    10) tsize=2, elitism=0 & 20751.42 & 522.79 & 20.32\% & 68.0   & 57.67 & 93790.43 & 3412.25 & 38953.09 & 4866.43 & 23.0  & 8.72  & 40.08 & 1.30  & 49.04\% \\
    11) elitism=0.1 & 18221.37 & 183.96 & 5.65\% & 200.0   & 44.69 & 87181.98 & 4258.95 & 24458.78 & 1656.04 & 118.0 & 6.56  & 33.06 & 1.16  & 48.76\% \\
    12) elitism=0.25, mutprob=0.3 & 18276.63 & 352.72 & 5.97\% & 175.0   & 30.50 & 85356.41 & 4601.98 & 23430.54 & 1195.40 & 117.0 & 8.12  & 27.23 & 1.39  & 47.89\% \\
    \bottomrule
    \end{tabular}%
    }
  \label{tabela1}%
  \caption{Melhor configuração de parâmetros aplicada às demais instâncias}
    \resizebox{\columnwidth}{!}{%
    \begin{tabular}{lc|c|c|c|c|c|c|c|c|c|c|c|c|c}
    \toprule
    \multirow{2}{*}{Instância} & \multicolumn{2}{c}{Melhor Fitness} & \multicolumn{1}{c}{Erro} & \multicolumn{2}{c}{na Geração} & \multicolumn{2}{c}{Pior Fitness} & \multicolumn{2}{c}{Fitness Média} & \multicolumn{2}{c}{Indiv. Rep.} & \multicolumn{2}{c}{Tempo de Exec.(s)} & \multicolumn{1}{c}{Filhos Melhores(\%)} \\
    \cmidrule{2-15}
    \multicolumn{1}{c}{}& \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Desvio P.} & \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Desvio P.} & \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Desvio P.} & \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Desvio P.} & \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Desvio P.} & \multicolumn{1}{c}{Média} & \multicolumn{1}{c}{Desvio P.} & \multicolumn{1}{c}{Média} \\
    \midrule
    \textit{SJC2.dat} & 34595.741 & 288.97 & 4.12\% & 220.0 & 22.83 & 173646.60 & 4626.67 & 39646.87 & 858.49 & 111   & 8.72  & 105.34 & 4.95  & 48.77\% \\
    \textit{SJC3b.dat} & 43088.299 & 593.01 & 6.04\% & 236.0 & 17.35 & 139948.18 & 16204.68 & 45019.74 & 801.56 & 105   & 12.33 & 333.82 & 7.25  & 49.72\% \\
    \textit{SJC4a.dat} & 68001.947 & 1107.33 & 9.96\% & 210.0 & 16.69 & 275545.13 & 21618.21 & 72824.61 & 903.47 & 99    & 13.76 & 482.35 & 6.32  & 48.70\% \\
    \bottomrule
    \end{tabular}%
    }
  \label{tabela2}%
\end{sidewaystable}%


\section{CONCLUSÃO}

O problema da $p$-Mediana é uma importante variação do problema de localização de facilidades onde $p$ medianas são economicamente selecionadas para servir um conjunto de facilidades demandantes de maneira que as capacidades das medianas seja respeitada. Nesse trabalho foi apresentada uma abordagem genética para a solução desse problema e o comportamento e eficiência dessa abordagem foram avaliados sob diferentes perspectivas.

Tendo em vista a adoção de uma outra heurística para o assinalamento de facilidades a medianas, o grande aprendizado desse trabalho vem, em primeira instância, da oportunidade de por em prática os conceitos que movem técnicas evolucionarias e, posteriormente, avaliar o impacto dos parâmetros na qualidade da solução. Ficou claro, por exemplo, que a pressão seletiva desempenha papel fundamental no resultado das soluções encontradas, sendo, portanto, essencial a inserção de fatores que contrabalancem esse efeito (aumento da probabilidade de mutação), e que é benéfica a presença de um fator de elitismo no processo evolucionário.

No caso do trabalho em questão, isso ficou mais evidente, ao ser observado que uma heurística orientada pela busca aleatória no espaço de soluções (através de mutações mais frequentes) produziu melhores soluções que a busca puramente evolucionária através de cruzamento.

Finalmente, fica sinalizado para trabalhos futuros, a avaliação da utilização de outros conceitos como \textit{niching} e otimização multi-objetiva. As restrições de desempenho do algoritmo também sugerem a avaliação de uma abordagem evolucionária paralela para a solução desse problema.



\nocite{*}
\bibliographystyle{sbc}
\bibliography{bib}

\end{document}
